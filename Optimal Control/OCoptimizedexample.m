% This script outputs Figure 2 of Anderson et al. (2024) representing 
% the optimal regimen for an average virtual mouse with glioblastoma.
% Uses: GBMFuncoptimal.m (and output from OCHiPerGator.m + GBMOptimalControl.m)

%% Parameter set for an average virtual mouse

param = [0.431;      % 1  - lambdaC
         3.04e6;     % 2  - Cmax
         2.57e-8;    % 3  - η 
         3.26e6;     % 4  - a_T 
         8.56e6;     % 5  - s_T 
         0.107;      % 6  - ρ        
         16.2;       % 7  - ε_C 
         6.92e-6;    % 8  - r 
         0.0221;     % 9  - d_T
         0.0466;     % 10 - s_M  
         0.251];     % 11 - d_M
 
     
%% Output for this parameter set from OCHiPerGator.m and GBMoptimalcontrol.m

treattime =[7.00000000000000;7.45653215830374;8.26964624448256;8.95953589172432;9.15000000513119;9.40445324083901;9.75554677147586;9.86666667350826;10.1211199092161;10.4722134398529;10.5833333418853;10.8377865775931;11.1888801082300;11.3000000102624;11.5120443733522;11.8046223155496;11.8972222339099;12.0032444154549;12.1495333865535;12.1958333457337;12.3018555272786;12.4481444983773;12.4944444575575;12.5651259119208;12.6626518926532;12.6935185321067;12.7641999864700;12.8617259672024;12.8925926066559;12.9632740610191;13.0608000417516;13.0916666812050;13.1022688993595;13.1168977964694;13.1215277923874;13.1321300105419;13.1467589076518;13.1513889035698;13.1619911217243;13.1766200188342;13.1812500147522;13.1918522329067;13.2064811300165;13.2111111259346;13.2217133440890;13.2363422411989;13.2409722371169;13.2515744552714;13.2662033523813;13.2708333482993;13.2779014937356;13.2876540918089;13.2907407557542;13.2978089011906;13.3075614992638;13.3106481632091;13.3177163086455;13.3274689067187;13.3305555706641;13.3376237161004;13.3473763141736;13.3504629781190;13.3575311235553;13.3672837216286;13.3703703855739;13.3774385310102;13.3871911290835;13.3902777930288;13.3973459384652;13.4070985365384;13.4101852004837;13.4172533459201;13.4270059439933;13.4300926079387;13.4371607533750;13.4469133514482;13.4500000153936;13.5454199787840;13.6770800527728;13.7187500160350;13.8141699794254;13.9458300534142;13.9875000166764;14.0829199800668;14.2145800540556;14.2562500173178;14.3516699807082;14.4833300546970;14.5250000179592;14.5886133268861;14.6763867095453;14.7041666850534;14.7677799939804;14.8555533766396;14.8833333521477;14.9469466610747;15.0347200437339;15.0625000192420;15.1579199826324;15.2895800566212;15.3312500198834;15.4266699832738;15.5583300572626;15.6000000205248;15.9816798740865;16.5083201700418;16.6750000230904;16.6909938571074;16.7267312653206;16.7777788946458;16.8379747947581;16.9000576646518;16.9565394853122;17.0006090643700;17.0269622210026;17.0333333572789;17.6694664465484;18.5472002731406;18.8250000282216;19.0532661073734;19.4598231504628;19.8047679740837;19.9000000307872;20.8130643473946;22.4392925197523;23.8190718142358;24.2000000410495;24.5392710219933;25.0073957295091;25.1555555988856;25.6079169068106;26.2320831834984;26.4296296760004;26.5427200029817;26.6987615721536;26.7481481952791;26.8612385222604;27.0172800914323;27.0666667145578;27.5755731859734;28.2777602472471;28.5000000513119;28.8043548235144;29.3464308809670;29.8063573124615;29.9333333880661;30.2376881602685;30.7797642177211;31.2396906492156;31.3666667248202;31.6710214970227;32.2130975544752;32.6730239859697;32.8000000615743;33.7130643781818;35.3392925505394;36.7190718450229;37.1000000718367;38.0130643884442;39.6392925608018;41.0190718552853;41.4000000820991;42.1633597892225;43.2166403811331;43.5500000872303;43.6559253047168;43.8773759941564;44.1541771676563;44.4121356650737;44.5822044933634;44.6250000897959;45.0066799433576;45.5333202393128;45.7000000923615;46.6130644089689;48.2392925813266;49.6190718758101;50.0000001026238];
treatstate = [274784.726817312,7435273.00623625,25368.6374287243;300659.544797666,7584232.95750589,28408.1877683362;350266.226392804,7728593.60345665,34334.1040497713;396360.924599604,7733736.21175004,39904.8820797443;409817.928944400,7717400.70603270,41535.7233120917;428332.390013186,7684309.83870008,43780.1910055158;454949.282081940,7618694.10941088,47004.9802150818;463645.882902919,7593366.28375296,48057.5014362383;484046.946937644,7558848.29480348,45630.3441554895;513076.267428436,7585390.98902609,42561.5712515093;522417.051829804,7608619.31315556,41655.5721362788;543979.425822416,7684899.37073363,39690.8955739517;573885.349330161,7834532.55123505,37218.5697770866;583330.062712351,7890791.59368369,36490.3107342607;601256.499922509,8008447.83566576,35169.0133700289;625648.439144533,8189754.32130743,33485.5475519924;633254.431168984,8251042.74199691,32984.7187333088;641881.702159575,8323275.15618184,32429.3877048132;653625.722380224,8426206.88144922,31693.8330977123;657300.518057769,8459509.80758547,31468.2483296136;665748.572419045,8481754.33982017,30964.4358786665;676562.062671038,9214286.41143273,30297.4027327041;679485.781377143,9867415.62143147,30092.8237443876;682868.220659394,10639985.6338563,29786.0675155359;686328.357387966,11220585.8735311,29373.1975683054;687266.784237417,11136145.3358166,29244.9078999724;689352.540356902,11524056.2965266,28955.3894360473;691030.714962138,12556293.3440548,28565.1158928646;691130.835997877,12778922.7928089,28443.6960035550;690973.887699409,13382211.4843141,28169.1606239698;689557.209474589,14171129.4087803,27797.9298404674;688833.894837049,14410991.1404655,27682.1493464086;688559.446451598,14457763.3958970,27642.5690155180;688165.430764298,14535830.3096397,27588.0985452170;688036.454141794,14514568.2620702,27570.8965411070;687743.792316498,14560853.3886218,27531.5720758673;687324.877298689,14638187.3270870,27477.4520701571;687188.079478929,14616908.9474659,27460.3603656165;686877.553895426,14662713.6873835,27421.2873580315;686434.221103505,14739324.4077793,27367.5117812289;686289.754277114,14718031.0047140,27350.5284776765;685961.712801309,14763361.9195226,27311.7026009961;685494.441218471,14839258.9136234,27258.2655290843;685342.456745008,14817951.7747873,27241.3887631107;684997.245319152,14862815.2531523,27202.8057709539;684506.511208582,14938007.7590118,27149.7013903388;684347.159570553,14916688.1515012,27132.9293333844;683985.122109199,14961090.4166750,27094.5850588955;683471.398872582,15035587.4297190,27041.8076651846;683304.829631182,15014256.6004030,27025.1385231179;683055.515574205,15006893.2934803,26999.7254231047;682713.436996152,14996783.2856019,26964.7134224282;682605.632929667,14993595.6582460,26953.6485983046;682359.606589167,14986318.1994186,26928.3392604680;682022.037721186,14976326.2199478,26893.4703061330;681915.654549314,14973175.8458667,26882.4507251630;681672.870349825,14965983.5085017,26857.2449339866;681339.748666931,14956108.5584596,26822.5187272431;681234.766687200,14952995.1223521,26811.5442943362;680995.179667698,14945887.1860166,26786.4418311725;680666.443486744,14936128.2749455,26751.8580690407;680562.843261623,14933051.4641988,26740.9286877629;680326.409065257,14926027.2146019,26715.9293309227;680001.997530688,14916383.3604845,26681.4877062371;679899.759883174,14913342.8651492,26670.6032788555;679666.434747062,14906401.5940838,26645.7068036741;679346.287817084,14896871.8232643,26611.4070052281;679245.393826322,14893867.3360291,26600.5674327108;679015.134571637,14887008.3413151,26575.7736116257;678699.193004628,14877591.6884198,26541.6153242493;678599.624001652,14874622.9045869,26530.8205063430;678372.388023896,14867845.4900138,26506.1291089386;678060.593365082,14858540.9978737,26472.1120135536;677962.330928628,14855607.6153340,26461.3618487841;677738.076188061,14848911.0906052,26436.7726419024;677430.370756515,14839717.8101783,26402.8964156782;677333.396708901,14836819.5293871,26392.1908013609;674431.200856829,14749856.9053988,26064.5601510290;670715.235683750,14637986.5481743,25623.1736512458;669604.416464187,14604466.8328937,25486.0303437021;667171.853620519,14531001.3833004,25176.5534450055;664053.489393401,14436873.7694826,24759.8361583612;663120.332615819,14408764.8848201,24630.4058744928;661074.910339654,14347332.3795699,24338.4152735615;658448.157611236,14269021.1149734,23945.4150129714;657660.879531030,14245735.1020901,23823.3897613016;656003.704888375,14155853.4958169,23548.1938703042;653487.389408491,14529178.4166587,23177.8790034776;652454.985617923,14944760.2663501,23062.8753710160;650429.274905384,15219522.4347175,22889.1477007109;647141.559967934,15669412.3237635,22652.8746799071;645966.752941385,15551186.5566351,22578.8826474616;643558.341231987,15477023.3492010,22410.8501007181;640195.321134351,15688258.8517865,22182.1864118676;639046.689815415,15943137.4971260,22110.5738528959;636144.389738635,16167698.8529725,21947.8590275379;631575.599640077,16840803.8725693,21726.0604893910;629910.355957219,16984012.9610254,21656.4730042612;624338.857289131,16884169.5567768,21419.4882287244;617048.461810843,16752772.2651715,21097.7742344909;614832.005665733,16712680.3724666,20997.2418087290;609913.164216380,16623506.6434679,20769.3781408946;603466.161928856,16506313.4851698,20460.3501160583;601503.628796940,16470595.0378505,20363.8506100723;585095.269360714,16172353.8251339,19509.2232828653;566390.820511364,15838445.0806222,18415.7533809404;561231.654229644,15749331.2115046,18090.1145338863;560754.425748433,15741172.7237639,18059.3693538289;559698.457699476,15723182.4059636,17990.9810291479;558214.495908771,15698053.1340239,17894.0530522809;556500.471150567,15669265.1545352,17780.8914438082;554772.101839474,15640514.1767326,17665.4667229603;553233.270708930,15615169.2132748,17561.5792292749;552054.180746286,15595921.7031243,17481.2621910547;551357.920341700,15584629.7647965,17433.5419646843;551190.569591731,15581924.1211877,17422.0401174763;536161.335528296,15355737.6130333,16339.3492621400;519644.698981592,15165070.9806429,15044.0976602995;515084.007514344,15127939.9638003,14677.7884335036;511539.545891970,15104713.4132115,14391.1084366177;505564.238838463,15077514.4406102,13910.8014461597;500762.087894868,15066962.2060482,13531.7572737992;499470.959071102,15065854.9825408,13431.4486311182;487604.283020748,15088069.2527325,12556.0782224365;467387.804005259,15228294.3070359,11314.6756124838;449963.813232745,15395996.8461936,10492.8546695970;445070.045151275,15445405.9721932,10293.6157014177;440667.133309824,15489607.4168796,10124.4745236762;434540.418407092,15550512.3831926,9902.64582294564;432589.875883105,15569672.9879202,9834.98692515017;426605.559654303,15627591.9096380,9635.31951884145;418292.246676333,15705482.1936702,9375.16305623554;415651.591199451,15729507.3282178,9296.10927604685;414145.823019485,15737768.3085994,9251.52005454288;412027.579780039,15815717.2305119,9190.74440636214;411329.375894387,15880564.8655995,9171.68029102022;409296.705216311,16536139.6324732,9128.21984689893;405303.312292415,17390010.5969179,9068.12956440462;403772.655618428,17648641.9798246,9048.94005712143;381834.733079478,20019156.8363987,8839.14430321875;339099.959567812,22522474.8127383,8494.16946163695;324197.909293300,23160039.6591062,8366.48187433342;303314.029924284,23925322.0757974,8179.40047257437;266455.327672022,25018404.8518435,7810.51805105459;236756.703590923,25713779.7255506,7467.31087089003;228922.953776867,25873225.5827314,7368.67206133640;210895.257345789,26204396.4162531,7126.71877679538;181568.596638260,26637649.7830427,6682.08054386277;159557.506129115,26874161.2806419,6297.92192285983;153934.198002736,26921499.5157544,6191.63781496734;141231.663974106,27007302.5769593,5937.54334066166;121161.502783207,27076645.0620859,5490.92106479909;106474.010204294,27067188.4548909,5122.02236170323;102763.633503999,27055399.1578160,5022.26680167972;79926.6271273802,26879753.7644261,4337.44596674002;52183.9698425675,26310505.8522433,3281.47261308143;37268.2693519977,25708274.4337238,2559.41253689551;34113.7687785098,25532400.6429898,2386.09076932406;27799.9367496506,25106107.9227310,2014.14729175120;19834.3425923730,24343036.5222512,1483.78976290164;15278.4997126898,23706330.5682082,1143.50560487253;14279.1190062885,23532999.2977887,1064.19040885042;12528.2693375972,23190629.9721991,915.789630939745;10580.1167154862,22721895.9985017,826.444343415833;10054.7197536605,22572228.8669760,854.630064150985;9896.45842427445,22517214.0415587,880.794793045592;9577.70703702288,22419887.7657345,930.885280114868;9201.85118716832,22266460.3117876,985.358352334487;8874.10993556381,22120238.6341390,1028.74107216211;8668.70119212715,22041729.2049254,1053.79269099704;8618.22851462302,22019179.3532333,1059.67862212841;8191.46244092073,21783412.2137036,1105.31962979055;7666.50178668504,21458116.6827454,1150.43800725800;7514.36713370968,21355432.5548030,1161.04953422624;6785.91899094805,20797553.4826140,1194.13247963163;5844.06674433158,19834528.3539476,1182.67802334815;5309.57208418892,19057485.7097603,1138.00106104067;5196.00135272524,18849780.7994115,1123.01193857522];
treatcontrol = [5.94467149550582e-07,2.14837278821878e-06;1.06048782688717e-07,4.47411510839935e-07;8.80324063867732e-08,5.06998550792170e-07;1.60964148809839e-07,1.43120717422396e-06;9.98964722853657e-07,1.05477058380987e-05;2.10872074246637e-07,3.42877785239337e-06;2.92174077154428e-07,2.27996038831002e-05;1.01218811763282e-06,0.899187162461905;2.14958568456325e-07,0.899994673301295;2.98517567642875e-07,0.899997052174309;1.03317202104769e-06,0.899991647782856;2.18991567235705e-07,0.899998708151121;3.02844982646988e-07,0.899998757764913;1.25734219635909e-06,0.899995373626727;2.66865168985220e-07,0.899999153128014;3.66645840443880e-07,0.899999049791805;2.53026347958318e-06,0.899993865799181;5.42157163296864e-07,0.899998757092264;7.40459001091765e-07,0.899998437691917;2.53280423847535e-06,0.899994811719912;5.40483497868394e-07,0.899998944947858;0.799999791262631,0.899998658952275;0.799998887156818,0.899993284433042;0.799999766426120,0.899998585146601;1.10745260291090e-06,0.899998122559911;3.76290142747315e-06,0.899993666278738;0.799999760751786,0.899998658568614;0.799999663631983,0.899998204118506;0.799998838495697,0.899993918869867;0.799999751110871,0.899998698013372;0.799999651131609,0.899998231578152;2.49482613309482e-05,0.899959854902177;0.799998246085382,0.899991304862977;7.35456561788972e-06,0.899988155110004;2.49269999511803e-05,0.899959838506501;0.799998233552208,0.899991300656194;7.34812124933981e-06,0.899988148164122;2.49051788751231e-05,0.899959813664241;0.799998220486389,0.899991294633846;7.34151267605121e-06,0.899988138773143;2.48828013203806e-05,0.899959780562986;0.799998206868388,0.899991286836108;7.33474091143549e-06,0.899988126990926;2.48598707867309e-05,0.899959739384400;0.799998192677546,0.899991277301922;7.32780705141600e-06,0.899988112869737;2.48363910483107e-05,0.899959690304847;0.799998177892004,0.899991266069130;7.32071227180775e-06,0.899988096460434;3.72369282990892e-05,0.899939434169069;8.06347529800355e-06,0.899986877236255;1.09782639155842e-05,0.899982120775146;3.72123840802541e-05,0.899939377724901;8.05813185862370e-06,0.899986865353471;1.09709483491649e-05,0.899982105238848;3.71875607518390e-05,0.899939325736559;8.05272789303757e-06,0.899986854437544;1.09635503521943e-05,0.899982091022152;3.71624581571695e-05,0.899939278225438;8.04726337020334e-06,0.899986844493010;1.09560698874134e-05,0.899982078131043;3.71370761736767e-05,0.899939235211656;8.04173826605137e-06,0.899986835524120;1.09485069270221e-05,0.899982066571128;3.71114147128093e-05,0.899939196714021;8.03615256450563e-06,0.899986827534845;1.09408614534789e-05,0.899982056347617;3.70854737203885e-05,0.899939162750011;8.03050625628465e-06,0.899986820528864;1.09331334594565e-05,0.899982047465327;3.70592531746539e-05,0.899939133335755;8.02479933974531e-06,0.899986814509564;1.09253229476636e-05,0.899982039928671;3.70327530890613e-05,0.899939108486015;8.01903182017227e-06,0.899986809480032;1.09174299300019e-05,0.899982033741653;2.73310587348696e-06,0.899995498817173;5.84161273931016e-07,0.899999030645172;7.94028152473203e-07,0.899998679792578;2.70429681377138e-06,0.899995512255315;5.77627545883530e-07,0.899999038349885;7.84597680292265e-07,0.899998699211092;2.67178299497850e-06,0.899995587490275;5.70299275137742e-07,0.899999059269544;7.74106467105185e-07,0.899998736047665;2.63762890617691e-06,0.899995719291914;5.62066512532766e-07,0.899999092727574;0.799999469107195,0.899998787168485;3.89451498050697e-06,0.899993838612494;0.799999345822601,0.899998681714941;1.13467312994331e-06,0.899998219508371;3.85855662377033e-06,0.899993963007187;8.26642425044710e-07,0.899998708904986;0.799998665185719,0.899998259825479;3.81277149137382e-06,0.899994104938589;0.799998819053896,0.899998739120974;0.799997952268159,0.899998296699218;2.51127037698140e-06,0.899996151734434;5.34806703011981e-07,0.899999181169981;7.24611595215308e-07,0.899998902066008;2.46688256928529e-06,0.899996283991153;5.25079594515532e-07,0.899999214891694;7.11186028912181e-07,0.899998956499304;5.99321723226964e-07,0.899999127960655;1.20053549990118e-07,0.899999836016428;1.59412667555259e-07,0.899999812562008;1.51043215207647e-05,0.899983144676853;2.51557242765266e-06,0.899997206818227;1.49505728113120e-06,0.899998358562338;1.15979251229525e-06,0.899998747227159;1.04922612642611e-06,0.899998888478659;1.07684164318833e-06,0.899998882089572;1.26529906117057e-06,0.899998710542360;1.80369549545034e-06,0.899998188171330;3.98875332203730e-06,0.899996027064636;3.18347165428889e-07,0.899999687649401;5.90436990410836e-08,0.899999955261634;7.68936730732861e-08,0.899999959131053;8.25178617480660e-07,0.899999563809323;1.47538267425418e-07,0.899999932123098;1.19777327123316e-07,0.899999953916260;2.11559879215173e-07,0.899999924544045;1.84032391858935e-07,0.899999937350221;2.66748346966494e-08,0.899999999352508;2.01184002790455e-08,0.900000000000000;4.40275371715870e-08,0.900000000000000;4.72964247855146e-07,0.899999964557386;1.00607077913040e-07,0.900000000000000;1.51738484399644e-07,0.899999998317134;4.10758692082069e-07,0.899999982813768;9.36700901288390e-08,0.900000000000000;1.67770157766256e-07,0.900000000000000;2.63769489734500e-06,0.899999930317676;6.06278542703009e-07,0.899999992337640;0.393230609373722,0.899999987024573;0.799999780170426,0.899999935286485;0.799999965275867,0.899999993354555;0.799999958854522,0.899999988234459;0.799999972350883,0.899999993458934;0.800000000000000,0.900000000000000;0.800000000000000,0.900000000000000;0.799999978057841,0.899999982779220;0.800000000000000,0.900000000000000;0.800000000000000,0.900000000000000;0.800000000000000,0.900000000000000;0.799999983149915,0.899999977847320;0.800000000000000,0.900000000000000;0.800000000000000,0.900000000000000;0.800000000000000,0.899999997370781;0.799999981797328,0.899999966692502;0.800000000000000,0.900000000000000;0.800000000000000,0.900000000000000;0.799999999260753,0.899999992025482;0.799999997513826,0.899999988310382;0.800000000000000,0.900000000000000;0.800000000000000,0.900000000000000;0.800000000000000,0.899999988523452;0.799999982496034,0.899999926379884;0.800000000000000,0.899999987008825;0.800000000000000,0.899999972500086;0.799999987318675,0.899999876038658;0.799999915670503,0.899999329829396;0.799999982146056,0.899999720506725;0.799999955393560,0.510842220487922;2.61897982212211e-06,4.16546646556548e-05;0.799999707173494,5.57998075855215e-06;0.799999787954421,2.52310853575133e-06;2.67677313647852e-07,1.72573674850351e-06;0.799999668327860,1.75953693245523e-06;0.799999231146507,3.27663241659337e-06;6.31198913358944e-07,2.90002209816231e-06;1.29476050814148e-07,5.16309237114099e-07;1.77320668637293e-07,5.88605574980417e-07;2.70203466090635e-07,8.50224159426594e-07;4.41174893062168e-08,1.27366713675858e-07;3.52311904094904e-08,8.89521883151723e-08;6.69753069448831e-08,1.55221633846292e-07;8.07579563122791e-08,1.87472156078330e-07];
T = [0;1;2;3;4;5;6;7];
X = [35000,100,0;51933.6543386661,2007291.13666385,1790.40618105662;73989.1019317354,3263192.61064928,3987.52539740336;101921.077678110,4370117.02756074,6730.26760009976;136047.489733253,5369862.84238640,10147.8545767202;176340.965448320,6240642.56016602,14346.1561031269;222605.889288810,6942023.82534829,19401.9365322406;274784.726817316,7435273.00623626,25368.6374287209];

% Compile times, states, and control from before treatment and during
time = [T(1:end-1,1);treattime];

state = zeros(length(time),3);
for i = 1:3
    state(:,i) = [X(1:end-1,i); treatstate(:,i)];
end
control = zeros(length(time),2);
for i = 1:2
    control(:,i) = [zeros(length(T)-1,1); treatcontrol(:,i)];
end

tf = time(end);


%% Determining survival data after treatment
yearsofsurvival = 6;
mouselifespan = 836; % average lifespan in days for C57BL/6 mice (Kunstyr 1975)
humanlifespan = 76.1; % average US lifespan according to 2022 CDC report
survivaldays = ceil(mouselifespan*(yearsofsurvival/humanlifespan)); 


[Tafter,Xafter] = ode45(@GBMFuncoptimal,[tf:1:tf+survivaldays],state(end,:),[],param);

timeafter = [time;Tafter(2:end,1)];

stateafter = zeros(length(timeafter),3);
for i = 1:3
    stateafter(:,i) = [state(1:end-1,i); Xafter(:,i)];
end
controlafter = zeros(length(timeafter),2);
for i = 1:2
    controlafter(:,i) = [control(:,i); zeros(length(Tafter)-1,1)];
end

tfafter = timeafter(end);
     

%% Figure Edits

fs = 24; % font size
ms = 8; % marker size
lw = 2; % line width

bcolor = "#EDB120"; % line color before treatment
pcolor = "#0072BD"; % during treatment
acolor = "#A2142F"; % after treatment
bls = ':'; % line style of before treatment
als = '--'; % line style of after treatment

yaxisub = [3e6, 3e7, 5e5, 1, 1]; % UB for y-axis


%% Figure 2 showcases before, during, and after treatment for an average virtual mouse.

figure
stateeqnspost = tiledlayout(2,3,'TileSpacing','compact');

% Tumor
ax1 = nexttile(1);
hold on
pp = plot(treattime,treatstate(:,1),'Color',pcolor);
after = plot(Tafter,Xafter(:,1),als,'Color',acolor);
before = plot(T,X(:,1),bls,'Color',bcolor);
scatter(111,Xafter(62,1),ms+150,'p','filled','k') % day tumor size surpasses mortality threshold
hold off
axis([0 tfafter 0 yaxisub(1)])
xl = xlabel('t (days)','Interpreter','LaTeX');
yl = ylabel('C (cells)','Interpreter','LaTeX');
set(xl,'FontSize',fs);
set(yl,'FontSize',fs);
set(gca,'LineWidth',1,'FontSize',fs-2,'FontName','Times');
set(pp,'LineWidth',lw,'MarkerSize',ms);
set(after,'LineWidth',lw,'MarkerSize',ms);
set(before,'LineWidth',lw,'MarkerSize',ms);
grid on;


% T cell
nexttile(2)
hold on
pp = plot(treattime,treatstate(:,2),'Color',pcolor);
after = plot(Tafter,Xafter(:,2),als,'Color',acolor);
before = plot(T,X(:,2),bls,'Color',bcolor);
scatter(111,Xafter(62,2),ms+150,'p','filled','k')
hold off
axis([0 tfafter 0 yaxisub(2)])
xl = xlabel('t (days)','Interpreter','LaTeX');
yl = ylabel('T (cells)','Interpreter','LaTeX');
set(xl,'FontSize',fs);
set(yl,'FontSize',fs);
set(gca,'LineWidth',1,'FontSize',fs-2,'FontName','Times');
set(pp,'LineWidth',lw,'MarkerSize',ms);
set(after,'LineWidth',lw,'MarkerSize',ms);
set(before,'LineWidth',lw,'MarkerSize',ms);
grid on;


% MDSC
ax1 = nexttile(3);
hold on
pp = plot(treattime,treatstate(:,3),'Color',pcolor);
after = plot(Tafter,Xafter(:,3),als,'Color',acolor);
before = plot(T,X(:,3),bls,'Color',bcolor);
death = scatter(111,Xafter(62,3),ms+150,'p','filled','k');
hold off
axis([0 tfafter 0 yaxisub(3)])
xl = xlabel('t (days)','Interpreter','LaTeX');
yl = ylabel('M (cells)','Interpreter','LaTeX');
set(xl,'FontSize',fs);
set(yl,'FontSize',fs);
set(gca,'LineWidth',1,'FontSize',fs-2,'FontName','Times');
set(pp,'LineWidth',lw,'MarkerSize',ms);
set(after,'LineWidth',lw,'MarkerSize',ms);
set(before,'LineWidth',lw,'MarkerSize',ms);
leg1 = legend(ax1,[before,pp,after,death],["Pre-Treatment","Treatment","Post-treatment","Death"],'FontSize',fs);
set(leg1,...
    'Position',[0.113541666666667 0.209090909090909 0.161458333333333 0.184722222222223],...
    'FontSize',fs);
grid on;


% Anti-PD-1 
nexttile(5)
hold on
pp = plot(treattime,treatcontrol(:,1),'Color',pcolor);
after = plot(Tafter,zeros(length(Tafter),1),als,'Color',acolor);
before = plot(T,zeros(length(T),1),bls,'Color',bcolor);
scatter(111,0,ms+150,'p','filled','k')
hold off
axis([0 tfafter 0 yaxisub(4)])
xl = xlabel('t (days)','Interpreter','LaTeX');
yl = ylabel('$u_1$ (\% reduction)','Interpreter','LaTeX');
set(xl,'FontSize',fs);
set(yl,'FontSize',fs);
set(gca,'LineWidth',1,'FontSize',fs-2,'FontName','Times');
set(pp,'LineWidth',lw,'MarkerSize',ms);
set(after,'LineWidth',lw,'MarkerSize',ms);
set(before,'LineWidth',lw,'MarkerSize',ms);
grid on;


% CCR2 Antagonist
ax = nexttile(6);
hold on
pp = plot(treattime,treatcontrol(:,2),'Color',pcolor);
after = plot(Tafter,zeros(length(Tafter),1),als,'Color',acolor);
before = plot(T,zeros(length(T),1),bls,'Color',bcolor);
scatter(111,0,ms+150,'p','filled','k')
hold off
axis([0 tfafter 0 yaxisub(5)])
xl = xlabel('t (days)','Interpreter','LaTeX');
yl = ylabel('$u_2$ (\% reduction)','Interpreter','LaTeX');
set(xl,'FontSize',fs);
set(yl,'FontSize',fs);
set(gca,'LineWidth',1,'FontSize',fs-2,'FontName','Times');
set(pp,'LineWidth',lw,'MarkerSize',ms);
set(after,'LineWidth',lw,'MarkerSize',ms);
set(before,'LineWidth',lw,'MarkerSize',ms);
grid on;

set(gcf,'Position',[0 300 1200 550],'PaperPositionMode','auto');
